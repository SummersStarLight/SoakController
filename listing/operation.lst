C51 COMPILER V7.50   OPERATION                                                             03/25/2014 21:12:20 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE OPERATION
OBJECT MODULE PLACED IN .\output\operation.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE source\operation.c LARGE BROWSE INCDIR(.\include\) DEBUG OBJECTEXTEND PRINT
                    -(.\listing\operation.lst) OBJECT(.\output\operation.obj)

line level    source

   1          #include <reg52.h>
   2          #include <position.h>
   3          #include <parameter.h>
   4          #include <basefunc.h>
   5          #include <operation.h>
   6          #include <intrins.h>
   7          
   8          sbit MotorLeft = P2^0; //机械臂向进口移动电机
   9          sbit MotorRight = P2^1; //机械臂向出口移动电机
  10          sbit ManiUp =  P1^0; //机械臂向上移动电机
  11          sbit ManiDown =  P1^1; //机械臂向下移动电机
  12          sbit MotorSpeedUp =  P1^2; //出口到进口空槽机械臂加速
  13          
  14          sbit sensorInput = P3^0; //进口位置感应
  15          sbit sensorManiTop = P3^1; //机械臂在顶端位置感应
  16          sbit sensorManiBut = P3^2; //机械臂在低端位置感应
  17          sbit sensorOutput = P3^3; //出位置感应
  18          
  19          /*
  20          void A_Move(uchar move_cisternNumber);          //机械臂A移动到cisternNumber号槽位置
  21          uchar A_Move_Steps = 100;                               //0：机械臂初始状态
  22                                                                                          //1：机械臂A定位前等待
  23                                                                                          //2：机械臂A定位
  24                                                                                          //100：机械臂空操作             
  25                                  
  26                                                                  
  27          void A_Down(uchar down_cisternNumber);          //机械臂A放产品框到cisternNumber号槽
  28          uchar A_Down_Steps = 100;                               //0：机械臂初始状态
  29                                                                                          //1：机械臂A定位前等待
  30                                                                                          //2：机械臂A定位
  31                                                                                          //3：机械臂A向下前等待
  32                                                                                          //4：机械臂A向下
  33                                                                                          //100：机械臂空操作
  34                                                                                          
  35          void A_Up(uchar up_cisternNumber);              //机械臂A提起cisternNumber号槽里面的产品框
  36          uchar A_Up_Steps = 100;                                 //0：机械臂初始状态
  37                                                                                          //1：机械臂A定位前等待
  38                                                                                          //2：机械臂A定位
  39                                                                                          //3：机械臂A向上前等待
  40                                                                                          //4：机械臂A向上
  41                                                                                          //100：机械臂空操作
  42          */
  43          void A_Up_Down(uchar upCisternNumber, uchar downCisternNumber); //机械臂提起upCisternNumber槽里面框放到dow
             -nCisternNumber槽
  44          uchar A_Up_Down_Steps = 100;                    //0：机械臂初始状态
  45                                                                                          //1：机械臂提起upCisternNumber槽中的框
  46                                                                                          //2：机械臂放框到downCisternNumber槽中
  47                                                                                          //100：机械臂空操作
  48          
  49          unsigned int timeBetweenOpeartionDry = timeBetweenOpeartion;            //机械臂调起后悬挂晾干时间
  50          
  51          
  52          void A_Move_Entrance(void);             //机械臂A移动到进口槽位置
  53          uchar A_Move_Entrance_Steps = 100;              //0：机械臂初始状态
C51 COMPILER V7.50   OPERATION                                                             03/25/2014 21:12:20 PAGE 2   

  54                                                                                          //1：机械臂A定位前等待
  55                                                                                          //2：机械臂A定位
  56                                                                                          //3：机械臂定位后等待
  57                                                                                          //100：机械臂空操作     
  58                                                                                          
  59          void ManualMode_Operation(void);  //手动模式                                                                                                                                                            
  60                                                                                          
  61          uint ManiOperationTimer = 0; //机械臂操作定时器
  62          
  63          void A_Up_Down(uchar upCisternNumber, uchar downCisternNumber)
  64          {
  65   1              switch(A_Up_Down_Steps)
  66   1              {
  67   2                      case 0:         //0：机械臂初始状态
  68   2                              ManiOperationTimer = 0;
  69   2                              A_Up_Down_Steps ++;
  70   2                      break;
  71   2                      case 1:         //1：机械臂A定位前等待
  72   2                              if(ManiOperationTimer > timeBetweenOpeartion) //定时时间到
  73   2                              {
  74   3                                      if(manipulator.currentPosition > upCisternNumber) //当前机械臂在cisternNumber号槽右边
  75   3                                      {
  76   4                                              MotorRight = 1;
  77   4                                              if(speedUpFlag == 1)//开启加速模式
  78   4                                              {
  79   5                                                      MotorLeft = 1; //行车向左
  80   5                                                      MotorSpeedUp = 0;       
  81   5                                              }
  82   4                                              else
  83   4                                              {
  84   5                                                      MotorLeft = 0; //行车向左
  85   5                                                      MotorSpeedUp = 1;
  86   5                                              }
  87   4                                              drivingDirect = DGoEntrance;
  88   4                                              manipulator.manipulaterStatus = GoEntrance;
  89   4                                              if(displayFlag == 0)
  90   4                                              {
  91   5                                                      displayFlag = 2;
  92   5                                              }
  93   4                                      }
  94   3                                      else if(manipulator.currentPosition < upCisternNumber)
  95   3                                      {
  96   4                                              MotorLeft = 1;          
  97   4                                              if(speedUpFlag == 1)
  98   4                                              {
  99   5                                                      MotorSpeedUp = 0;
 100   5                                                      MotorRight = 1; 
 101   5                                              }
 102   4                                              else
 103   4                                              {
 104   5                                                      MotorSpeedUp = 1;
 105   5                                                      MotorRight = 0; //行车向右
 106   5                                              }
 107   4                                              drivingDirect = GoOutfall;
 108   4                                              manipulator.manipulaterStatus = DGoOutfall;
 109   4                                              if(displayFlag == 0)
 110   4                                              {
 111   5                                                      displayFlag = 2;
 112   5                                              }
 113   4                                      }
 114   3                                      else
 115   3                                      {
C51 COMPILER V7.50   OPERATION                                                             03/25/2014 21:12:20 PAGE 3   

 116   4                                              MotorSpeedUp = 1;
 117   4                                              A_Up_Down_Steps++;      
 118   4                                      }       
 119   3                              }
 120   2                      break;
 121   2                      case 2:         //2：机械臂A定位
 122   2                              if(manipulator.currentPosition == upCisternNumber)
 123   2                              {
 124   3                                      ManiOperationTimer = 0;
 125   3                                      MotorLeft = 1;
 126   3                                      MotorRight = 1;
 127   3                                      //drivingDirect = DStop;
 128   3                                      manipulator.manipulaterStatus = Stop;
 129   3                                      if(displayFlag == 0)
 130   3                                      {
 131   4                                              displayFlag = 2;
 132   4                                      }
 133   3                                      A_Up_Down_Steps ++;
 134   3                              }
 135   2                      break;
 136   2                      case 3:         //1：机械臂A定位前等待
 137   2                              if(ManiOperationTimer > timeBetweenOpeartion) //定时时间到
 138   2                              {
 139   3                                      if(manipulator.currentPosition > upCisternNumber) //当前机械臂在cisternNumber号槽右边
 140   3                                      {                                       
 141   4                                              MotorRight = 1;
 142   4                                              if(speedUpFlag == 1)
 143   4                                              {
 144   5                                                      MotorLeft = 1; //行车向左
 145   5                                                      MotorSpeedUp = 0;       
 146   5                                              }
 147   4                                              else
 148   4                                              {
 149   5                                                      MotorLeft = 0; //行车向左
 150   5                                                      MotorSpeedUp = 1;
 151   5                                              }
 152   4                                              drivingDirect = DGoEntrance;
 153   4                                              manipulator.manipulaterStatus = GoEntrance;
 154   4                                              if(displayFlag == 0)
 155   4                                              {
 156   5                                                      displayFlag = 2;
 157   5                                              }
 158   4                                              A_Up_Down_Steps = 2;
 159   4                                      }
 160   3                                      else if(manipulator.currentPosition < upCisternNumber)
 161   3                                      {
 162   4                                              MotorLeft = 1;
 163   4                                              if(speedUpFlag == 1)
 164   4                                              {
 165   5                                                      MotorSpeedUp = 0;
 166   5                                                      MotorRight = 1; //行车向右      
 167   5                                              }
 168   4                                              else
 169   4                                              {
 170   5                                                      MotorSpeedUp = 1;
 171   5                                                      MotorRight = 0; //行车向右
 172   5                                              }
 173   4                                              drivingDirect = GoOutfall;
 174   4                                              manipulator.manipulaterStatus = DGoOutfall;
 175   4                                              if(displayFlag == 0)
 176   4                                              {
 177   5                                                      displayFlag = 2;
C51 COMPILER V7.50   OPERATION                                                             03/25/2014 21:12:20 PAGE 4   

 178   5                                              }
 179   4                                              A_Up_Down_Steps = 2;
 180   4                                      }
 181   3                                      else
 182   3                                      {
 183   4                                              MotorSpeedUp = 1;
 184   4                                              if(displayFlag == 0)
 185   4                                              {
 186   5                                                      displayFlag = 2;
 187   5                                              }
 188   4                                              A_Up_Down_Steps ++;     
 189   4                                      }       
 190   3                              }
 191   2                      break;
 192   2                      case 4:
 193   2                              ManiUp = 0;
 194   2                              manipulator.manipulaterStatus = GoUp;
 195   2                              if(displayFlag == 0)
 196   2                              {
 197   3                                      displayFlag = 2;
 198   3                              }
 199   2                              A_Up_Down_Steps++;
 200   2                      break;
 201   2                      case 5:         //4：机械臂A向上 
 202   2                              if(sensorManiTop == 0) //机械臂A顶端感应器感应到
 203   2                              {
 204   3                                      ManiUp = 1;
 205   3                                      manipulator.manipulatorPosition = Top;
 206   3                                      manipulator.manipulaterStatus = Stop;   
 207   3                                      cistern[upCisternNumber/2].cisternStatus = Empty;//标记当前槽为满
 208   3                                      cistern[upCisternNumber/2].currentTime = 0;//清除当前槽计时时间
 209   3                                      displayFlag = 1;
 210   3                                      A_Up_Down_Steps ++;
 211   3                              }
 212   2                      break;
 213   2                      case 6:         //0：机械臂初始状态
 214   2                              ManiOperationTimer = 0;
 215   2                              A_Up_Down_Steps ++;
 216   2                      break;
 217   2                      case 7:         //1：机械臂A定位前等待
 218   2                              if(ManiOperationTimer > timeBetweenOpeartionDry) //定时时间到
 219   2                              {
 220   3                                      if(manipulator.currentPosition > downCisternNumber) //当前机械臂在cisternNumber号槽右边
 221   3                                      {
 222   4                                              MotorRight = 1;
 223   4                                              if(speedUpFlag == 1)
 224   4                                              {
 225   5                                                      MotorSpeedUp = 0;
 226   5                                                      MotorLeft = 1; //行车向左       
 227   5                                              }
 228   4                                              else
 229   4                                              {
 230   5                                                      MotorSpeedUp = 1;
 231   5                                                      MotorLeft = 0; //行车向左
 232   5                                              }
 233   4                                              drivingDirect = DGoEntrance;
 234   4                                              manipulator.manipulaterStatus = GoEntrance;
 235   4                                              if(displayFlag == 0)
 236   4                                              {
 237   5                                                      displayFlag = 2;
 238   5                                              }
 239   4                                      }
C51 COMPILER V7.50   OPERATION                                                             03/25/2014 21:12:20 PAGE 5   

 240   3                                      else if(manipulator.currentPosition < downCisternNumber)
 241   3                                      {
 242   4                                              MotorLeft = 1;
 243   4                                              if(speedUpFlag == 1)
 244   4                                              {
 245   5                                                      MotorSpeedUp = 0;
 246   5                                                      MotorRight = 1; //行车向右      
 247   5                                              }
 248   4                                              else
 249   4                                              {
 250   5                                                      MotorSpeedUp = 1;
 251   5                                                      MotorRight = 0; //行车向右
 252   5                                              }
 253   4                                              drivingDirect = GoOutfall;
 254   4                                              manipulator.manipulaterStatus = DGoOutfall;
 255   4                                              if(displayFlag == 0)
 256   4                                              {
 257   5                                                      displayFlag = 2;
 258   5                                              }
 259   4                                      }
 260   3                                      else
 261   3                                      {
 262   4                                              MotorSpeedUp = 1;
 263   4                                              A_Up_Down_Steps++;      
 264   4                                      }       
 265   3                              }
 266   2                      break;
 267   2                      case 8:         //2：机械臂A定位
 268   2                              if(manipulator.currentPosition == downCisternNumber)
 269   2                              {
 270   3                                      ManiOperationTimer = 0;
 271   3                                      MotorLeft = 1;
 272   3                                      MotorRight = 1;
 273   3                                      //drivingDirect = DStop;
 274   3                                      manipulator.manipulaterStatus = Stop;
 275   3                                      if(displayFlag == 0)
 276   3                                      {
 277   4                                              displayFlag = 2;
 278   4                                      }
 279   3                                      A_Up_Down_Steps ++;
 280   3                              }
 281   2                      break;
 282   2                      case 9:         //1：机械臂A定位前等待
 283   2                              if(ManiOperationTimer > timeBetweenOpeartion) //定时时间到
 284   2                              {
 285   3                                      if(manipulator.currentPosition > downCisternNumber) //当前机械臂在cisternNumber号槽右边
 286   3                                      {
 287   4                                              MotorRight = 1;
 288   4                                              if(speedUpFlag == 1)
 289   4                                              {
 290   5                                                      MotorSpeedUp = 0;
 291   5                                                      MotorLeft = 1; //行车向左       
 292   5                                              }
 293   4                                              else
 294   4                                              {
 295   5                                                      MotorSpeedUp = 1;
 296   5                                                      MotorLeft = 0; //行车向左
 297   5                                              }
 298   4                                              drivingDirect = DGoEntrance;
 299   4                                              manipulator.manipulaterStatus = GoEntrance;
 300   4                                              if(displayFlag == 0)
 301   4                                              {
C51 COMPILER V7.50   OPERATION                                                             03/25/2014 21:12:20 PAGE 6   

 302   5                                                      displayFlag = 2;
 303   5                                              }
 304   4                                              A_Up_Down_Steps = 8;
 305   4                                      }
 306   3                                      else if(manipulator.currentPosition < downCisternNumber)
 307   3                                      {
 308   4                                              MotorLeft = 1;
 309   4                                              if(speedUpFlag == 1)
 310   4                                              {
 311   5                                                      MotorSpeedUp = 0;
 312   5                                                      MotorRight = 1; //行车向右      
 313   5                                              }
 314   4                                              else
 315   4                                              {
 316   5                                                      MotorSpeedUp = 1;
 317   5                                                      MotorRight = 0; //行车向右
 318   5                                              }
 319   4                                              drivingDirect = GoOutfall;
 320   4                                              manipulator.manipulaterStatus = DGoOutfall;
 321   4                                              if(displayFlag == 0)
 322   4                                              {
 323   5                                                      displayFlag = 2;
 324   5                                              }
 325   4                                              A_Up_Down_Steps = 8;
 326   4                                      }
 327   3                                      else
 328   3                                      {
 329   4                                              MotorSpeedUp = 1;
 330   4                                              if(displayFlag == 0)
 331   4                                              {
 332   5                                                      displayFlag = 2;
 333   5                                              }
 334   4                                              A_Up_Down_Steps ++;     
 335   4                                      }       
 336   3                              }
 337   2                      break;
 338   2                      case 10:
 339   2                              ManiDown = 0;
 340   2                              manipulator.manipulaterStatus = GoDown;
 341   2                              if(displayFlag == 0)
 342   2                              {
 343   3                                      displayFlag = 2;
 344   3                              }
 345   2                              A_Up_Down_Steps++;
 346   2                      break;
 347   2                      case 11:                //4：机械臂A向下 
 348   2                              if(sensorManiBut == 0) //机械臂A底端感应器感应到
 349   2                              {
 350   3                                      ManiDown = 1;
 351   3                                      manipulator.manipulatorPosition = Bottom;
 352   3                                      manipulator.manipulaterStatus = Stop;   
 353   3                                      cistern[downCisternNumber/2].cisternStatus = InCounting;//标记当前槽为满
 354   3                                      cistern[downCisternNumber/2].currentTime = 0;//清除当前槽计时时间
 355   3                                      displayFlag = 1;
 356   3                                      A_Up_Down_Steps = 100;
 357   3                              }
 358   2                      break;
 359   2                      default:
 360   2                                _nop_();
 361   2              }       
 362   1      }
 363          
C51 COMPILER V7.50   OPERATION                                                             03/25/2014 21:12:20 PAGE 7   

 364          void A_Move_Entrance(void)
 365          {
 366   1              switch(A_Move_Entrance_Steps)
 367   1              {
 368   2                      case 0:         //0：机械臂初始状态
 369   2                              ManiOperationTimer = 0;
 370   2                              A_Move_Entrance_Steps ++;
 371   2                      break;
 372   2                      case 1:         //1：机械臂A定位前等待
 373   2                              if(ManiOperationTimer > timeBetweenOpeartion) //定时时间到
 374   2                              {
 375   3                                      MotorLeft = 0; //行车向左
 376   3                                      drivingDirect = DGoEntrance;
 377   3                                      manipulator.manipulaterStatus = GoEntrance;
 378   3                                      if(displayFlag == 0)
 379   3                                      {
 380   4                                              displayFlag = 2;
 381   4                                      }
 382   3                                      A_Move_Entrance_Steps++;
 383   3                              }
 384   2                      break;
 385   2                      case 2:         //2：机械臂A定位
 386   2                              if(sensorInput == 0)
 387   2                              {
 388   3                                      ManiOperationTimer = 0;
 389   3                                      MotorLeft = 1;
 390   3                                      MotorRight = 1;
 391   3                                      drivingDirect = DStop;
 392   3                                      manipulator.manipulaterStatus = Stop;
 393   3                                      if(displayFlag == 0)
 394   3                                      {
 395   4                                              displayFlag = 2;
 396   4                                      }
 397   3                                      manipulator.currentPosition = 0;
 398   3                                      A_Move_Entrance_Steps ++;
 399   3                              }
 400   2                      break;
 401   2                      case 3:         //2：机械臂A定位
 402   2                              if(ManiOperationTimer > timeBetweenOpeartion) //定时时间到
 403   2                              {
 404   3                                      ManiOperationTimer = 0;
 405   3                                      manipulator.currentPosition = 0;
 406   3                                      A_Move_Entrance_Steps = 100;
 407   3                              }
 408   2                      break;
 409   2                      default:
 410   2                                _nop_();
 411   2              }
 412   1      }
 413          
 414          void ManualMode_Operation(void)
 415          {
 416   1              MotorLeft = 1;
 417   1              MotorRight = 1;
 418   1              ManiUp =  1;
 419   1              ManiDown =  1;
 420   1              MotorSpeedUp =  1;      
 421   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    975    ----
C51 COMPILER V7.50   OPERATION                                                             03/25/2014 21:12:20 PAGE 8   

   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      6    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
