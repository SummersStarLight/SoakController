C51 COMPILER V7.50   OPERATION                                                             04/07/2014 23:01:25 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE OPERATION
OBJECT MODULE PLACED IN .\output\operation.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE source\operation.c LARGE BROWSE INCDIR(.\include\) DEBUG OBJECTEXTEND PRINT
                    -(.\listing\operation.lst) OBJECT(.\output\operation.obj)

line level    source

   1          #include <reg52.h>
   2          #include <position.h>
   3          #include <parameter.h>
   4          #include <basefunc.h>
   5          #include <operation.h>
   6          #include <intrins.h>
   7          
   8          sbit MotorLeft = P2^0; //机械臂向进口移动电机
   9          sbit MotorRight = P2^1; //机械臂向出口移动电机
  10          sbit ManiUp =  P1^0; //机械臂向上移动电机
  11          sbit ManiDown =  P1^1; //机械臂向下移动电机
  12          sbit MotorSpeedUp =  P1^2; //出口到进口空槽机械臂加速
  13          
  14          sbit sensorInput = P3^0; //进口位置感应
  15          sbit sensorManiTop = P3^1; //机械臂在顶端位置感应
  16          sbit sensorManiBut = P3^2; //机械臂在低端位置感应
  17          sbit sensorOutput = P3^3; //出位置感应
  18          
  19          /*
  20          void A_Move(uchar move_cisternNumber);          //机械臂A移动到cisternNumber号槽位置
  21          uchar A_Move_Steps = 100;                               //0：机械臂初始状态
  22                                                                                          //1：机械臂A定位前等待
  23                                                                                          //2：机械臂A定位
  24                                                                                          //100：机械臂空操作             
  25                                  
  26                                                                  
  27          void A_Down(uchar down_cisternNumber);          //机械臂A放产品框到cisternNumber号槽
  28          uchar A_Down_Steps = 100;                               //0：机械臂初始状态
  29                                                                                          //1：机械臂A定位前等待
  30                                                                                          //2：机械臂A定位
  31                                                                                          //3：机械臂A向下前等待
  32                                                                                          //4：机械臂A向下
  33                                                                                          //100：机械臂空操作
  34                                                                                          
  35          void A_Up(uchar up_cisternNumber);              //机械臂A提起cisternNumber号槽里面的产品框
  36          uchar A_Up_Steps = 100;                                 //0：机械臂初始状态
  37                                                                                          //1：机械臂A定位前等待
  38                                                                                          //2：机械臂A定位
  39                                                                                          //3：机械臂A向上前等待
  40                                                                                          //4：机械臂A向上
  41                                                                                          //100：机械臂空操作
  42          */
  43          void A_Up_Down(uchar upCisternNumber, uchar downCisternNumber); //机械臂提起upCisternNumber槽里面框放到dow
             -nCisternNumber槽
  44          uchar A_Up_Down_Steps = 100;                    //0：机械臂初始状态
  45                                                                                          //1：机械臂提起upCisternNumber槽中的框
  46                                                                                          //2：机械臂放框到downCisternNumber槽中
  47                                                                                          //100：机械臂空操作
  48          
  49          unsigned int timeBetweenOpeartionDry = timeBetweenOpeartion;            //机械臂调起后悬挂晾干时间
  50          
  51          
  52          void A_Move_Entrance(void);             //机械臂A移动到进口槽位置
  53          uchar A_Move_Entrance_Steps = 100;              //0：机械臂初始状态
C51 COMPILER V7.50   OPERATION                                                             04/07/2014 23:01:25 PAGE 2   

  54                                                                                          //1：机械臂A定位前等待
  55                                                                                          //2：机械臂A定位
  56                                                                                          //3：机械臂定位后等待
  57                                                                                          //100：机械臂空操作     
  58                                                                                          
  59          void ManualMode_Operation(void);  //手动模式                                                                                                                                                            
  60                                                                                          
  61          uint ManiOperationTimer = 0; //机械臂操作定时器
  62          
  63          void A_Up_Down(uchar upCisternNumber, uchar downCisternNumber)
  64          {
  65   1              switch(A_Up_Down_Steps)
  66   1              {
  67   2                      case 0:         //0：机械臂初始状态
  68   2                              ManiOperationTimer = 0;
  69   2                              A_Up_Down_Steps ++;
  70   2                      break;
  71   2                      case 1:         //1：机械臂A定位前等待
  72   2                              if(ManiOperationTimer > timeBetweenOpeartion) //定时时间到
  73   2                              {
  74   3                                      if(manipulator.currentPosition > upCisternNumber) //当前机械臂在cisternNumber号槽右边
  75   3                                      {
  76   4                                              MotorLeft = 0; //行车向左
  77   4                                              MotorRight = 1;
  78   4                                              drivingDirect = DGoEntrance;
  79   4                                              manipulator.manipulaterStatus = GoEntrance;
  80   4                                              if(displayFlag == 0)
  81   4                                              {
  82   5                                                      displayFlag = 2;
  83   5                                              }
  84   4                                      }
  85   3                                      else if(manipulator.currentPosition < upCisternNumber)
  86   3                                      {
  87   4                                              MotorLeft = 1;  
  88   4                                              MotorRight = 0; //行车向右      
  89   4                                              drivingDirect = GoOutfall;
  90   4                                              manipulator.manipulaterStatus = DGoOutfall;
  91   4                                              if(displayFlag == 0)
  92   4                                              {
  93   5                                                      displayFlag = 2;
  94   5                                              }
  95   4                                      }
  96   3                                      else
  97   3                                      {
  98   4                                              MotorSpeedUp = 1;
  99   4                                              A_Up_Down_Steps++;      
 100   4                                      }       
 101   3                              }
 102   2                      break;
 103   2                      case 2:         //2：机械臂A定位
 104   2                              if(manipulator.currentPosition == upCisternNumber)
 105   2                              {
 106   3                                      ManiOperationTimer = 0;
 107   3                                      MotorLeft = 1;
 108   3                                      MotorRight = 1;
 109   3                                      //drivingDirect = DStop;
 110   3                                      manipulator.manipulaterStatus = Stop;
 111   3                                      if(displayFlag == 0)
 112   3                                      {
 113   4                                              displayFlag = 2;
 114   4                                      }
 115   3                                      A_Up_Down_Steps ++;
C51 COMPILER V7.50   OPERATION                                                             04/07/2014 23:01:25 PAGE 3   

 116   3                              }
 117   2                      break;
 118   2                      case 3:         //1：机械臂A定位前等待
 119   2                              if(ManiOperationTimer > timeBetweenOpeartion) //定时时间到
 120   2                              {
 121   3                                      if(manipulator.currentPosition > upCisternNumber) //当前机械臂在cisternNumber号槽右边
 122   3                                      {
 123   4                                              MotorLeft = 0; //行车向左
 124   4                                              MotorRight = 1;
 125   4                                              drivingDirect = DGoEntrance;
 126   4                                              manipulator.manipulaterStatus = GoEntrance;
 127   4                                              if(displayFlag == 0)
 128   4                                              {
 129   5                                                      displayFlag = 2;
 130   5                                              }
 131   4                                              A_Up_Down_Steps = 2;
 132   4                                      }
 133   3                                      else if(manipulator.currentPosition < upCisternNumber)
 134   3                                      {
 135   4                                              MotorLeft = 1;
 136   4                                              MotorRight = 0; //行车向右
 137   4      
 138   4                                              drivingDirect = GoOutfall;
 139   4                                              manipulator.manipulaterStatus = DGoOutfall;
 140   4                                              if(displayFlag == 0)
 141   4                                              {
 142   5                                                      displayFlag = 2;
 143   5                                              }
 144   4                                              A_Up_Down_Steps = 2;
 145   4                                      }
 146   3                                      else
 147   3                                      {
 148   4                                              MotorSpeedUp = 1;
 149   4                                              if(displayFlag == 0)
 150   4                                              {
 151   5                                                      displayFlag = 2;
 152   5                                              }
 153   4                                              A_Up_Down_Steps ++;     
 154   4                                      }       
 155   3                              }
 156   2                      break;
 157   2                      case 4:
 158   2                              ManiUp = 0;
 159   2                              manipulator.manipulaterStatus = GoUp;
 160   2                              if(displayFlag == 0)
 161   2                              {
 162   3                                      displayFlag = 2;
 163   3                              }
 164   2                              A_Up_Down_Steps++;
 165   2                      break;
 166   2                      case 5:         //4：机械臂A向上 
 167   2                              if(sensorManiTop == 0) //机械臂A顶端感应器感应到
 168   2                              {
 169   3                                      ManiUp = 1;
 170   3                                      manipulator.manipulatorPosition = Top;
 171   3                                      manipulator.manipulaterStatus = Stop;   
 172   3                                      cistern[upCisternNumber/2].cisternStatus = Empty;//标记当前槽为满
 173   3                                      cistern[upCisternNumber/2].currentTime = 0;//清除当前槽计时时间
 174   3                                      displayFlag = 1;
 175   3                                      A_Up_Down_Steps ++;
 176   3                              }
 177   2                      break;
C51 COMPILER V7.50   OPERATION                                                             04/07/2014 23:01:25 PAGE 4   

 178   2                      case 6:         //0：机械臂初始状态
 179   2                              ManiOperationTimer = 0;
 180   2                              A_Up_Down_Steps ++;
 181   2                      break;
 182   2                      case 7:         //1：机械臂A定位前等待
 183   2                              if(ManiOperationTimer > timeBetweenOpeartionDry) //定时时间到
 184   2                              {
 185   3                                      if(manipulator.currentPosition > downCisternNumber) //当前机械臂在cisternNumber号槽右边
 186   3                                      {
 187   4                                              MotorLeft = 0; //行车向左
 188   4                                              MotorRight = 1;
 189   4                                              drivingDirect = DGoEntrance;
 190   4                                              manipulator.manipulaterStatus = GoEntrance;
 191   4                                              if(displayFlag == 0)
 192   4                                              {
 193   5                                                      displayFlag = 2;
 194   5                                              }
 195   4                                      }
 196   3                                      else if(manipulator.currentPosition < downCisternNumber)
 197   3                                      {
 198   4                                              MotorLeft = 1;
 199   4                                              MotorRight = 0; //行车向右
 200   4      
 201   4                                              drivingDirect = GoOutfall;
 202   4                                              manipulator.manipulaterStatus = DGoOutfall;
 203   4                                              if(displayFlag == 0)
 204   4                                              {
 205   5                                                      displayFlag = 2;
 206   5                                              }
 207   4                                      }
 208   3                                      else
 209   3                                      {
 210   4                                              MotorSpeedUp = 1;
 211   4                                              A_Up_Down_Steps++;      
 212   4                                      }       
 213   3                              }
 214   2                      break;
 215   2                      case 8:         //2：机械臂A定位
 216   2                              if(manipulator.currentPosition == downCisternNumber)
 217   2                              {
 218   3                                      ManiOperationTimer = 0;
 219   3                                      MotorLeft = 1;
 220   3                                      MotorRight = 1;
 221   3                                      //drivingDirect = DStop;
 222   3                                      manipulator.manipulaterStatus = Stop;
 223   3                                      if(displayFlag == 0)
 224   3                                      {
 225   4                                              displayFlag = 2;
 226   4                                      }
 227   3                                      A_Up_Down_Steps ++;
 228   3                              }
 229   2                      break;
 230   2                      case 9:         //1：机械臂A定位前等待
 231   2                              if(ManiOperationTimer > timeBetweenOpeartion) //定时时间到
 232   2                              {
 233   3                                      if(manipulator.currentPosition > downCisternNumber) //当前机械臂在cisternNumber号槽右边
 234   3                                      {
 235   4                                              MotorLeft = 0; //行车向左
 236   4                                              MotorRight = 1;
 237   4                                              drivingDirect = DGoEntrance;
 238   4                                              manipulator.manipulaterStatus = GoEntrance;
 239   4                                              if(displayFlag == 0)
C51 COMPILER V7.50   OPERATION                                                             04/07/2014 23:01:25 PAGE 5   

 240   4                                              {
 241   5                                                      displayFlag = 2;
 242   5                                              }
 243   4                                              A_Up_Down_Steps = 8;
 244   4                                      }
 245   3                                      else if(manipulator.currentPosition < downCisternNumber)
 246   3                                      {
 247   4                                              MotorLeft = 1;
 248   4                                              MotorRight = 0; //行车向右
 249   4      
 250   4                                              drivingDirect = GoOutfall;
 251   4                                              manipulator.manipulaterStatus = DGoOutfall;
 252   4                                              if(displayFlag == 0)
 253   4                                              {
 254   5                                                      displayFlag = 2;
 255   5                                              }
 256   4                                              A_Up_Down_Steps = 8;
 257   4                                      }
 258   3                                      else
 259   3                                      {
 260   4                                              MotorSpeedUp = 1;
 261   4                                              if(displayFlag == 0)
 262   4                                              {
 263   5                                                      displayFlag = 2;
 264   5                                              }
 265   4                                              A_Up_Down_Steps ++;     
 266   4                                      }       
 267   3                              }
 268   2                      break;
 269   2                      case 10:
 270   2                              ManiDown = 0;
 271   2                              manipulator.manipulaterStatus = GoDown;
 272   2                              if(displayFlag == 0)
 273   2                              {
 274   3                                      displayFlag = 2;
 275   3                              }
 276   2                              A_Up_Down_Steps++;
 277   2                      break;
 278   2                      case 11:                //4：机械臂A向下 
 279   2                              if(sensorManiBut == 0) //机械臂A底端感应器感应到
 280   2                              {
 281   3                                      ManiDown = 1;
 282   3                                      manipulator.manipulatorPosition = Bottom;
 283   3                                      manipulator.manipulaterStatus = Stop;   
 284   3                                      cistern[downCisternNumber/2].cisternStatus = InCounting;//标记当前槽为满
 285   3                                      cistern[downCisternNumber/2].currentTime = 0;//清除当前槽计时时间
 286   3                                      displayFlag = 1;
 287   3                                      A_Up_Down_Steps = 100;
 288   3                              }
 289   2                      break;
 290   2                      default:
 291   2                                _nop_();
 292   2              }       
 293   1      }
 294          
 295          void A_Move_Entrance(void)
 296          {
 297   1              switch(A_Move_Entrance_Steps)
 298   1              {
 299   2                      case 0:         //0：机械臂初始状态
 300   2                              ManiOperationTimer = 0;
 301   2                              A_Move_Entrance_Steps ++;
C51 COMPILER V7.50   OPERATION                                                             04/07/2014 23:01:25 PAGE 6   

 302   2                      break;
 303   2                      case 1:         //1：机械臂A定位前等待
 304   2                              if(ManiOperationTimer > timeBetweenOpeartion) //定时时间到
 305   2                              {
 306   3                                      MotorLeft = 0; //行车向左
 307   3                                      drivingDirect = DGoEntrance;
 308   3                                      manipulator.manipulaterStatus = GoEntrance;
 309   3                                      if(displayFlag == 0)
 310   3                                      {
 311   4                                              displayFlag = 2;
 312   4                                      }
 313   3                                      A_Move_Entrance_Steps++;
 314   3                              }
 315   2                      break;
 316   2                      case 2:         //2：机械臂A定位
 317   2                              if(sensorInput == 0)
 318   2                              {
 319   3                                      ManiOperationTimer = 0;
 320   3                                      MotorLeft = 1;
 321   3                                      MotorRight = 1;
 322   3                                      drivingDirect = DStop;
 323   3                                      manipulator.manipulaterStatus = Stop;
 324   3                                      if(displayFlag == 0)
 325   3                                      {
 326   4                                              displayFlag = 2;
 327   4                                      }
 328   3                                      manipulator.currentPosition = 0;
 329   3                                      A_Move_Entrance_Steps ++;
 330   3                              }
 331   2                      break;
 332   2                      case 3:         //2：机械臂A定位
 333   2                              if(ManiOperationTimer > timeBetweenOpeartion) //定时时间到
 334   2                              {
 335   3                                      ManiOperationTimer = 0;
 336   3                                      manipulator.currentPosition = 0;
 337   3                                      A_Move_Entrance_Steps = 100;
 338   3                              }
 339   2                      break;
 340   2                      default:
 341   2                                _nop_();
 342   2              }
 343   1      }
 344          
 345          void ManualMode_Operation(void)
 346          {
 347   1              MotorLeft = 1;
 348   1              MotorRight = 1;
 349   1              ManiUp =  1;
 350   1              ManiDown =  1;
 351   1              MotorSpeedUp =  1;      
 352   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    853    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      6    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V7.50   OPERATION                                                             04/07/2014 23:01:25 PAGE 7   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
