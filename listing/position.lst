C51 COMPILER V7.50   POSITION                                                              04/19/2014 13:01:31 PAGE 1   


C51 COMPILER V7.50, COMPILATION OF MODULE POSITION
OBJECT MODULE PLACED IN .\output\position.obj
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE source\position.c LARGE BROWSE INCDIR(.\include\) DEBUG OBJECTEXTEND PRINT(
                    -.\listing\position.lst) OBJECT(.\output\position.obj)

line level    source

   1          #include <reg52.h>
   2          #include <position.h>
   3          #include <parameter.h>
   4          #include <basefunc.h>
   5          
   6          //sbit sensorPositon = P3^4; //机械臂定位传感器
   7          //机械臂定位传感器
   8          #define sensorPositon P3
   9          
  10          
  11          uchar sensorPosiCheck = 0; //机械臂A位置检测标志位 
  12                                                                  //0：没有感应器没有低电位状态
  13                                                                  //1：检测到低电位进入延迟状态
  14                                                                  //2：等待低电位释放进入延时
  15                                                                  //3：检测低电位确实释放 
  16          
  17          uchar getPositonBySensor() //根据传感器获取机械臂位置
  18          {
  19   1              if(sensorPositon == 0xFE)       //进口
  20   1              {
  21   2                      return  0;
  22   2              }
  23   1              else if(sensorPositon == 0xFD) //一号槽
  24   1              {
  25   2                      return  2;
  26   2              }
  27   1              else if(sensorPositon == 0xFB)   //二号槽
  28   1              {
  29   2                      return  4;
  30   2              }
  31   1              else if(sensorPositon == 0xF7)  //三号槽
  32   1              {
  33   2                      return  6;
  34   2              }
  35   1              else if(sensorPositon == 0xEF)   //四号槽
  36   1              {
  37   2                      return  8;
  38   2              }
  39   1              else if(sensorPositon == 0xDF)    //五号槽
  40   1              {
  41   2                      return  10;
  42   2              }
  43   1              else if(sensorPositon == 0xBF)   //六号槽
  44   1              {
  45   2                      return  12;
  46   2              }
  47   1              else if(sensorPositon == 0x7F)  //出口
  48   1              {
  49   2                      return  14;
  50   2              }
  51   1              else
  52   1              {
  53   2                      //传感器错误
  54   2                      runMode = ManualMode;
C51 COMPILER V7.50   POSITION                                                              04/19/2014 13:01:31 PAGE 2   

  55   2                      return 100;
  56   2              }       
  57   1      }
  58          
  59          void maniPosition(void) //机械臂定位
  60          {
  61   1              uchar  getPositonBySensorValue = 0;
  62   1              //机械臂A位置检测
  63   1              if(sensorPosiCheck==0)
  64   1              {
  65   2                      if(sensorPositon != 0xFF)
  66   2                      {
  67   3                              sensorPosiCheck = 1;
  68   3                      }
  69   2              }
  70   1              else if(sensorPosiCheck==1)
  71   1              {
  72   2                      if(sensorPositon != 0xFF)
  73   2                      {
  74   3                              if(drivingDirect == DGoOutfall)
  75   3                              {
  76   4                                      //向右机械臂位置加一
  77   4                                      manipulator.currentPosition = getPositonBySensor();
  78   4                              }
  79   3                              else if (drivingDirect == DGoEntrance)
  80   3                              {
  81   4                                      //向右机械臂位置减一
  82   4                                      manipulator.currentPosition = getPositonBySensor();     
  83   4                              }
  84   3                              sensorPosiCheck = 2;
  85   3                      }
  86   2                      else
  87   2                      {
  88   3                              //干扰信号直接释放
  89   3                              sensorPosiCheck = 0;
  90   3                      }
  91   2              }
  92   1              else if(sensorPosiCheck==2)
  93   1              {
  94   2                      if(sensorPositon == 0xFF)
  95   2                      {
  96   3                              sensorPosiCheck = 3;
  97   3                      }       
  98   2              }
  99   1              else
 100   1              {
 101   2                      if(sensorPositon == 0xFF)
 102   2                      {
 103   3                              if(drivingDirect == DGoOutfall)
 104   3                              {
 105   4                                      //向右机械臂位置加一
 106   4                                      manipulator.currentPosition++;
 107   4                                      displayFlag = 1;
 108   4                                      if(manipulator.currentPosition>14)
 109   4                                      {
 110   5                                              manipulator.currentPosition = 14;
 111   5                                      }
 112   4                              }
 113   3                              else if (drivingDirect == DGoEntrance)
 114   3                              {
 115   4                                      //向右机械臂位置减一
 116   4                                      manipulator.currentPosition--;
C51 COMPILER V7.50   POSITION                                                              04/19/2014 13:01:31 PAGE 3   

 117   4                                      displayFlag = 1;
 118   4                                      if(manipulator.currentPosition>200)
 119   4                                      {
 120   5                                              manipulator.currentPosition = 0;
 121   5                                      }       
 122   4                              }
 123   3                              sensorPosiCheck = 0;
 124   3                      }
 125   2              }
 126   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    224    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =      1       1
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
